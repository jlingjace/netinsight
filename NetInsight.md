# NetInsight

## 产品简介
NetInsight 是一款面向开发者和企业的现代化网络数据分析平台，聚焦于 HAR/PCAP 等主流网络抓包文件的智能解析、性能与安全分析、可视化和自动化报告。平台采用模块化、可扩展的架构，兼顾易用性与专业性，适合中小团队快速落地。

## 核心价值
- 降低网络数据分析门槛，非专家也能快速定位问题
- 支持主流网络数据格式，自动化解析与分析
- 性能、安全、异常一站式洞察
- 结果可视化、报告自动生成，便于协作与决策
- 纯前后端分离，数据本地处理，保障隐私安全

## 系统架构（最佳实践，易读版）
NetInsight 采用经典的分层架构，便于理解和扩展。整体分为五大层次：

**1. 前端层（用户界面）**
- 技术选型：React、TypeScript、Ant Design、ECharts
- 主要职责：
  - 提供文件上传、分析结果展示、可视化报表等交互界面
  - 通过 HTTP API 与后端通信

**2. API 网关层**
- 技术选型：Nginx
- 主要职责：
  - 统一入口，转发前端请求到后端服务
  - 实现 HTTPS、安全限流、CORS、API 版本控制

**3. 后端服务层**
- 技术选型：Node.js、Express、TypeScript
- 主要职责：
  - 用户认证与权限管理
  - 文件上传与管理
  - 任务调度与异步处理
  - 调用数据解析与分析引擎
  - 生成和存储分析报告

**4. 分析与任务处理层**
- 技术选型：自研/集成 HAR/PCAP 解析库、Bull（任务队列）、Redis（缓存）
- 主要职责：
  - 解析 HAR/PCAP 文件，抽取结构化数据
  - 性能与安全分析，生成优化建议
  - 异步任务处理，提升系统吞吐量
  - 结果缓存，加速用户查询

**5. 数据存储层**
- 技术选型：PostgreSQL（结构化数据）、本地/对象存储（文件）、Redis（缓存）
- 主要职责：
  - 存储用户、文件、分析结果等核心数据
  - 文件原始数据安全存储
  - 提供高效索引与归档能力

**架构简图（文字版）**

用户浏览器
  ↓
前端应用（React/TS/AntD）
  ↓ HTTP API
API 网关（Nginx）
  ↓
后端服务（Node.js/Express）
  ↓
├─ 分析与任务处理（HAR/PCAP解析、Bull、Redis）
├─ 数据存储（PostgreSQL、文件存储、Redis）

> 产品经理可关注：前端体验、分析能力、报告输出、权限与协作
> 程序员可关注：各层技术选型、接口设计、任务与数据流、可扩展性

## 核心模块设计
### 1. 用户与权限管理（IAM & RBAC）
- 用户注册、登录、登出、信息管理
- 角色权限（用户/管理员），支持团队协作
- Token/JWT 认证，支持多因子认证（可选）

### 2. 文件管理
- 支持 HAR/PCAP/PCAPNG 等格式上传与校验
- 大文件分片上传、断点续传
- 文件元数据、历史版本管理
- 文件安全检测与配额控制

### 3. 数据解析引擎
- HAR/PCAP 自动识别与解析
- 统一数据抽象，便于后续分析
- 错误处理与格式兼容性保障

### 4. 性能与安全分析引擎
- 性能指标统计（响应时间、流量、丢包、延迟等）
- 协议分布、异常检测、端口扫描识别
- 安全威胁初步识别（如高频连接、异常流量）
- 智能生成优化建议

### 5. 可视化与报告
- 多维度交互式图表（ECharts/D3）
- 自动生成 PDF/CSV/HTML 报告
- 历史趋势与对比分析
- 支持报告分享与协作

### 6. 任务队列与异步处理
- Bull/Redis 实现文件解析与分析任务异步化
- 支持任务重试、失败告警、进度追踪

### 7. 缓存与加速
- Redis 用于会话、文件状态、分析结果缓存
- 降低数据库压力，提高响应速度

### 8. 数据存储
- PostgreSQL 结构化存储用户、文件、分析结果
- 文件本地或对象存储（如 MinIO/S3）
- 支持索引与归档

### 9. API 网关与安全
- Nginx 反向代理，统一入口
- HTTPS、限流、CORS、API 版本控制
- 日志与监控

## 专家级网络分析与协作扩展
为满足网络专家和架构师的深度分析需求，NetInsight 建议补充以下高级功能：

### 1. HAR/PCAP 跨层关联分析
- 自动识别同一业务流在 HAR（应用层）和 PCAP（网络层）中的对应关系，支持一键跳转和对比
- 端到端链路追踪，将浏览器请求与底层网络包自动串联，定位链路瓶颈
- 多维度时间线对齐，直观展示 HAR 事件与 PCAP 抓包的时序关系

### 2. 协议深度解析与专家视图
- 支持 HTTP/2、QUIC、TLS、WebSocket、DNS、TCP、UDP、ICMP 等多协议的深度解码和统计
- 提供原始包内容、协议字段、流量重组、payload 还原等专家级视图
- 支持自定义协议解析插件，便于扩展特殊协议

### 3. 智能告警与根因分析
- 跨层异常自动诊断，如应用层超时与网络丢包/慢握手的自动关联分析
- 支持自定义智能告警规则（RTT、丢包率、重传、慢查询等）
- 自动给出根因建议，提升定位效率

### 4. 多端协作与注释
- 支持在报告、流量片段、会话等处添加专家批注，便于团队协作
- 分析流程留痕，记录分析步骤、过滤条件和结论，便于复盘和交接

### 5. 数据导入导出与集成
- 支持将关键流量片段导出为新的 HAR/PCAP 文件，便于与 Wireshark、Splunk 等工具集成
- 开放 API，便于分析结果、原始数据、告警等与企业运维、监控、SIEM 平台对接

### 6. 性能与安全的联合分析
- 安全事件与性能事件联动，自动分析异常流量对业务性能的影响
- 对接外部威胁情报库，对可疑 IP/域名/流量进行标记和溯源

### 7. 大规模数据处理与自动化
- 支持批量导入、自动化分析、定时任务，适合大规模网络环境
- 支持多点抓包数据的统一分析与聚合，适合跨地域/多出口网络架构

## 技术栈
- 前端：React 18+、TypeScript、Ant Design、ECharts、React Router
- 后端：Node.js 18+、Express、TypeScript、Multer、Bull、Redis、PostgreSQL
- 分析引擎：自研/集成 HAR/PCAP 解析库
- 可视化：ECharts、D3.js
- 部署：Docker、Docker Compose、Nginx
- CI/CD：GitHub Actions/GitLab CI

## 数据流与处理流程
1. 用户上传网络抓包文件（HAR/PCAP）
2. 文件校验、存储，生成元数据
3. 任务队列异步触发解析与分析
4. 解析引擎抽取结构化数据
5. 性能/安全分析引擎生成指标与建议
6. 结果存储、缓存，并生成可视化报告
7. 用户可随时查询、下载、分享分析结果

## 数据库与缓存设计（简化）
- users（用户表）：id, email, password_hash, name, role, created_at, last_login_at
- files（文件表）：id, user_id, original_name, file_name, file_path, file_type, file_size, status, error_message, uploaded_at, processed_at
- analysis_results（分析结果）：id, file_id, analysis_type, summary_data, detailed_data, chart_data, recommendations, created_at
- user_sessions（会话表）：id, user_id, token_hash, expires_at, created_at
- Redis：会话、文件状态、分析结果缓存

## 部署与运维
- 推荐 Docker Compose 一键部署，包含 app、db、redis、nginx
- 环境变量集中管理（.env.production）
- 支持 HTTPS、健康检查、自动重启
- 日志与监控可选集成 Prometheus/Grafana

## 开发与迭代计划（建议）
- Phase 1：基础功能（认证、文件上传、HAR 解析）
- Phase 2：核心分析（性能分析、PCAP 支持、可视化）
- Phase 3：完善体验（队列、缓存、错误处理、报告）
- Phase 4：测试部署（自动化测试、性能优化、生产部署）

---
本整合文档基于业界最佳实践，去除了冗余与不合理需求，聚焦于高效、可扩展、易维护的网络数据分析平台设计。 